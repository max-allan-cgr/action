on: [push]
jobs:
  buildit:
    strategy:
      matrix:
        directory: [a,b,c]
    runs-on: ubuntu-latest
    env:
      DOCKER_PLATFORMS: linux/amd64,linux/arm64
    steps:
      - name: 'â“ Setup QEMU'
        uses: docker/setup-qemu-action@v3
        with:
          image: tonistiigi/binfmt:latest
          platforms: all

      - name: 'ğŸ‹ Set up docker buildx'
        uses: docker/setup-buildx-action@v3

      # Here is the build and push action

      - name: 'ğŸ³ Build & Push Image'
        uses: docker/build-push-action@v6
        id: build
        with:
          file: ${{matrix.directory}}/Dockerfile
          platforms: ${{ env.DOCKER_PLATFORMS }}
          push: false
          tags: "localhost:5000/foo:latest"

#We build for - DOCKER_PLATFORMS: linux/amd64,linux/arm64
